version: v2
description: accelerate-rl4lms-llama-5node-ppo
tasks:
- name: accelerate-rl4lms-llama-5node-ppo
  replicas: 5
  leaderSelection: true
  hostNetworking: true
  image:
    beaker: rajammanabrolu/rl4lms-accelerate-llama-batch-noeval-dev-1
  command: [ '/bin/sh', '-c']
  arguments: ['cd /stage/code/ && export PYTHONPATH=/stage/code:/stage/code/rl4lms:$PYTHONPATH && echo $PYTHONPATH && bash run.sh /stage/code/beaker/llama_configs/accelerate_llama_config.yaml /stage/code/beaker/llama_configs/llama_beaker_ppo_7b.yml /stage/code/scripts/training/train_text_generation.py']
  resources:
    gpuCount: 8
  envVars:
    - name: WANDB_API_KEY
      secret: WANDB_API_KEY
  datasets:
    - mountPath: '/stage/config'
      source:
        hostPath: '/net/nfs.cirrascale/mosaic/raja/llama/llama_configs'
    - mountPath: '/stage/llama-tokenizer'
      source:
        hostPath: '/net/nfs.cirrascale/mosaic/raja/llama/llama-tokenizer'
    - mountPath: '/stage/llama-7b'
      source:
        hostPath: '/net/nfs.cirrascale/mosaic/raja/llama/llama-7b'
    - mountPath: '/stage/llama-13b'
      source:
        hostPath: '/net/nfs.cirrascale/mosaic/raja/llama/llama-13b'
    - mountPath: '/stage/llama-30b'
      source:
        hostPath: '/net/nfs.cirrascale/mosaic/raja/llama/llama-30b'
    - mountPath: '/stage/llama-65b'
      source:
        hostPath: '/net/nfs.cirrascale/mosaic/raja/llama/llama-65b'
    - mountPath: '/stage/code/'
      source:
        hostPath: '/net/nfs.cirrascale/mosaic/raja/RL4LMs'
    - mountPath: '/stage/.cache'
      source:
        hostPath: '/net/nfs.cirrascale/mosaic/raja/hf_cache/.cache/huggingface'
# /home/raja/.cache/huggingface/hub/models--facebook--opt-30b:#
#    - mountPath: '/stage/config'
#      source:
#        beaker: 01GVRBWV35ZNN96EPPTDP9PDRM
#    - mountPath: '/stage/llama-tokenizer'
#      source:
#        beaker: 01GVPWC8DNRGR0WXXR6BAS0S5R
#    - mountPath: '/stage/llama-7b'
#      source:
#        beaker: 01GVJWXQHD2HEN3QJ4MAPBF2Q4
#    - mountPath: '/stage/llama-13b'
#      source:
#        beaker: 01GVJX37MDM01Z8E73CP2XMJM3
#    - mountPath: '/stage/llama-30b'
#      source:
#        beaker: 01GVK1YRTRSNNPZEN6VDT33S8X
#    - mountPath: '/stage/llama-65b'
#      source:
#        beaker: 01GVK2T2CJJNJTHB5GRWHY2JTP
  result:
    path: /output
  context:
    priority: high
  constraints:
    cluster: [ ai2/general-cirrascale-a100-80g-ib ]